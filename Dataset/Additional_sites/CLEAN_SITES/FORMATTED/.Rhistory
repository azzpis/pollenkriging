#now we format all the files
setwd('Additional_sites/CLEAN_SITES/FORMATTED')
setwd("C:/Users/pistone/OneDrive - Eidg. Forschungsanstalt WSL/Working_directory_kriging_new_sites/Data for publication/Dataset/Additional_sites/CLEAN_SITES/FORMATTED/To_merge")
#now we format all the files
setwd('Additional_sites/CLEAN_SITES/FORMATTED')
setwd("C:/Users/pistone/OneDrive - Eidg. Forschungsanstalt WSL/Working_directory_kriging_new_sites/Data for publication/Dataset/Additional_sites/CLEAN_SITES/FORMATTED/To_merge")
filenames <- list.files(pattern="*.xlsx", full.names=TRUE)
library(readxl)
library(dplyr)
store_data = list()
store.names = list()
i = 1
print(i)
name = sub("_form.xlsx", "", filenames[i])
name = sub("./", "", name)
load.metadata = metadata[metadata$filename == name,]
load.metadata = load.metadata[!is.na(load.metadata$SiteN),]
metadata = read.csv("C:/Users/pistone/OneDrive - Eidg. Forschungsanstalt WSL/Working_directory_kriging_new_sites/site.metadata.to.complete.csv")
library(readxl)
library(dplyr)
store_data = list()
store.names = list()
print(i)
name = sub("_form.xlsx", "", filenames[i])
name = sub("./", "", name)
load.metadata = metadata[metadata$filename == name,]
load.metadata = load.metadata[!is.na(load.metadata$SiteN),]
setwd("C:/Users/pistone/OneDrive - Eidg. Forschungsanstalt WSL/Working_directory_kriging_new_sites/Data for publication/Dataset/Additional_sites/CLEAN_SITES/FORMATTED")
metadata = read.csv("C:/Users/pistone/OneDrive - Eidg. Forschungsanstalt WSL/Working_directory_kriging_new_sites/site.metadata.to.complete.csv")
filenames <- list.files(pattern="*.xlsx", full.names=TRUE)
library(readxl)
library(dplyr)
store_data = list()
store.names = list()
print(i)
name = sub("_form.xlsx", "", filenames[i])
name = sub("./", "", name)
load.metadata = metadata[metadata$filename == name,]
load.metadata = load.metadata[!is.na(load.metadata$SiteN),]
x = read_xlsx(filenames[i])
names(x)[1] = 'CalYrBP'
store.names[[i]] = names(x)
x$Pollen_sum = rowSums(x[,2:ncol(x)], na.rm = T)
#Correction factors
x[,which(names(x) %in% c("Larix", "Larix decidua"))] = x[,which(names(x) %in% c("Larix", "Larix decidua"))]*4
x[,which(names(x) %in% c("Pinus sylvestris","Pinus sylvestris-type","Pinus","Pinus nigra-type",
"Pinus pinaster","Pinus subg. Pinus" , "Pinus subg. Pinus-type"))] = x[,which(names(x) %in% c("Pinus sylvestris","Pinus sylvestris-type","Pinus","Pinus nigra-type",
"Pinus pinaster","Pinus subg. Pinus" , "Pinus subg. Pinus-type"))]*0.25
x[,which(names(x) %in% c("Acer","Acer campestre,Acer campestre-type","Acer negundo"))] = x[,which(names(x) %in% c("Acer","Acer campestre,Acer campestre-type","Acer negundo"))]*4
x[,which(names(x) %in% c("Alnus","Alnus glutinosa",
"Alnus glutinosa-type","Alnus incana",
"Alnus subg. Alnobetula","Alnus viridis",
"Alnus vitis"))] = x[,which(names(x) %in% c("Alnus","Alnus glutinosa",
"Alnus glutinosa-type","Alnus incana",
"Alnus subg. Alnobetula","Alnus viridis",
"Alnus vitis"))]*0.25
x[,which(names(x) %in% c("Betula","Betula humilis","Betula nana","Betula pubescens","Betula sect. Betula","Betula/Corylus/Myrica"))] = x[,which(names(x) %in% c("Betula","Betula humilis","Betula nana","Betula pubescens","Betula sect. Betula","Betula/Corylus/Myrica"))]*0.25
x[,which(names(x) %in% c("Corylus","Corylus avellana","Corylus avellana-type","Corylus/Myrica"))] = x[,which(names(x) %in% c("Corylus","Corylus avellana","Corylus avellana-type","Corylus/Myrica"))]*0.25
x[,which(names(x) %in% c("Ostrya","Ostrya-type" ,"Ostrya carpinifolia","Ostrya carpinifolia/Carpinus orientalis","Ostrya/Carpinus","Ostrya/Carpinus orientalis","Ostrya/Carpinus orientalis-type"))] = x[,which(names(x) %in% c("Ostrya","Ostrya-type" ,"Ostrya carpinifolia","Ostrya carpinifolia/Carpinus orientalis","Ostrya/Carpinus","Ostrya/Carpinus orientalis","Ostrya/Carpinus orientalis-type"))]*0.25
x[,which(names(x) %in% c("Salix","Salix herbacea-type","Salix polaris-type","Salix undiff."))] = x[,which(names(x) %in% c("Salix","Salix herbacea-type","Salix polaris-type","Salix undiff."))]*4
x[,which(names(x) %in% c("Tilia","Tilia cordata","Tilia cordata-type","Tilia platyphyllos-type"))] = x[,which(names(x) %in% c("Tilia","Tilia cordata","Tilia cordata-type","Tilia platyphyllos-type"))]*4
x[,which(names(x) %in% c("Buxus","Buxus sempervirens"))] = x[,which(names(x) %in% c("Buxus","Buxus sempervirens"))]*4
x[,which(names(x) %in% c("Plantago lanceolata","Plantago lanceolata-type" ))] = x[,which(names(x) %in% c("Plantago lanceolata","Plantago lanceolata-type" ))]*2
x[,which(names(x) %in% c("Cerealia-type", "Poaceae (Cerealia-type)","Poaceae (Cerealia)", "Poaceae (Cerealia) undiff.",
"Poaceae (>37 Âµm)", "Poaceae (annulus >10 Âµm)"))] = x[,which(names(x) %in% c("Cerealia-type", "Poaceae (Cerealia-type)","Poaceae (Cerealia)", "Poaceae (Cerealia) undiff.",
"Poaceae (>37 Âµm)", "Poaceae (annulus >10 Âµm)"))]*4
x[,2:(ncol(x)-1)]
